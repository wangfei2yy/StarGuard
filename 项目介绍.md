# StarGuard2 权限管理系统

## 项目概述

StarGuard2 是一个基于 Spring Boot 开发的数据库权限管理系统，专注于提供直观、高效的权限管理功能，包括用户列表展示、权限授予和撤销等核心操作。该系统通过友好的用户界面，帮助管理员轻松管理数据库权限，提升系统安全性和运维效率。

## 技术栈

### 后端技术
- **Spring Boot 2.7.18** - 核心应用框架
- **Spring MVC** - Web请求处理
- **Spring Data JPA** - 数据访问层
- **Thymeleaf** - 服务器端模板引擎
- **MySQL/StarRocks** - 数据库存储

### 前端技术
- **HTML5 + CSS3** - 页面结构与样式
- **JavaScript (ES6+)** - 交互逻辑实现
- **jQuery 3.5.1** - DOM操作库
- **Bootstrap 4.6.2** - 响应式UI框架
- **Font Awesome** - 图标库

## 项目结构

StarGuard2 采用标准的 Spring Boot 项目结构，代码组织清晰，便于维护和扩展。

```
StarGuard2/
├── src/
│   ├── main/
│   │   ├── java/org/authority/StarGuard2/  # Java源代码
│   │   │   ├── config/                     # 配置类
│   │   │   ├── controller/                 # 控制器
│   │   │   ├── dto/                        # 数据传输对象
│   │   │   ├── exception/                  # 异常处理
│   │   │   ├── model/                      # 数据模型
│   │   │   ├── repository/                 # 数据访问层
│   │   │   ├── service/                    # 业务逻辑层
│   │   │   └── Application.java            # 应用入口
│   │   └── resources/                      # 资源文件
│   │       ├── static/                     # 静态资源(CSS, JS, 图片等)
│   │       ├── templates/                  # Thymeleaf模板
│   │       └── application.properties      # 应用配置
│   └── test/                               # 测试代码
├── pom.xml                                 # Maven项目配置
└── target/                                 # 构建输出目录
```

## 核心功能模块

### 1. 用户管理模块

用户管理模块负责展示系统中的用户列表，并提供查看用户权限详情的功能。

**主要功能：**
- 加载并显示所有用户信息
- 查看指定用户的详细权限列表
- 支持用户按用户名和主机名筛选

**关键代码：**
- 用户列表加载与渲染：<mcfile name="user-manager.js" path="d:\IdeaProjects\authority\StarGuard2\src\main\resources\static\js\user-manager.js"></mcfile>
- 用户控制器：<mcfile name="UserController.java" path="d:\IdeaProjects\authority\StarGuard2\src\main\java\org\authority\StarGuard2\controller\UserController.java"></mcfile>

### 2. 权限管理模块

权限管理模块是系统的核心，提供权限授予和撤销功能，支持多种权限类型和作用范围。

**主要功能：**
- 授予用户数据库/表/视图等不同级别权限
- 撤销用户已有的权限
- 支持批量授权和撤销操作
- 权限作用范围精细化控制（单库/所有库、单表/所有表、单视图/所有视图）

**支持的权限类型：**
- 基础权限：SELECT、INSERT、UPDATE、DELETE、ALTER、DROP等
- 视图权限：CREATE VIEW、SELECT VIEW等
- 物化视图权限：CREATE MATERIALIZED VIEW、REFRESH MATERIALIZED VIEW等
- 系统权限：CREATE RESOURCE GROUP、CREATE EXTERNAL CATALOG等

**关键代码：**
- 权限服务接口：<mcfile name="PermissionService.java" path="d:\IdeaProjects\authority\StarGuard2\src\main\java\org\authority\StarGuard2\service\PermissionService.java"></mcfile>
- 权限服务实现：<mcfile name="PermissionServiceImpl.java" path="d:\IdeaProjects\authority\StarGuard2\src\main\java\org\authority\StarGuard2\service\impl\PermissionServiceImpl.java"></mcfile>
- 权限控制器：<mcfile name="PermissionController.java" path="d:\IdeaProjects\authority\StarGuard2\src\main\java\org\authority\StarGuard2\controller\PermissionController.java"></mcfile>

### 3. 安全认证模块

安全认证模块确保只有授权用户才能访问系统，保护系统数据安全。

**主要功能：**
- 用户登录认证
- 会话管理
- 资源访问权限控制
- 登录拦截器

**关键代码：**
- 登录控制器：<mcfile name="LoginController.java" path="d:\IdeaProjects\authority\StarGuard2\src\main\java\org\authority\StarGuard2\controller\LoginController.java"></mcfile>
- 登录拦截器：<mcfile name="LoginInterceptor.java" path="d:\IdeaProjects\authority\StarGuard2\src\main\java\org\authority\StarGuard2\config\LoginInterceptor.java"></mcfile>

## 前端架构

StarGuard2 前端采用模块化的 JavaScript 组织方式，通过 AJAX 请求与后端 API 进行交互，实现了响应式的用户界面。

### 前端模块结构

1. **app.js** - 主应用模块，负责初始化应用、设置事件监听器和协调各模块工作
2. **user-manager.js** - 用户管理模块，处理用户列表加载和渲染
3. **permission-manager.js** - 权限管理模块，处理权限授予和撤销逻辑
4. **ui-utils.js** - UI工具模块，提供消息提示、模态框操作等通用UI功能

### 页面结构

系统前端页面采用 Bootstrap 响应式设计，主要包括：
- 登录页面（login.html）
- 主页面（index.html），包含：
  - 侧边栏导航菜单
  - 用户列表展示区
  - 权限授予/撤销表单
  - 权限详情模态框

## 核心API接口

StarGuard2 遵循 RESTful API 设计原则，提供了以下核心 API 接口：

### 用户管理
- **GET /api/permission/users** - 获取所有用户列表
- **GET /api/permission/users/{username}/{host}** - 获取指定用户的权限详情

### 权限管理
- **POST /api/permission/grant** - 授予用户权限
- **POST /api/permission/revoke** - 撤销用户权限
- **POST /api/permission/batch-grant** - 批量授予用户权限
- **POST /api/permission/batch-revoke** - 批量撤销用户权限

## 部署与运行

### 环境要求
- JDK 1.8 或更高版本
- Maven 3.6+ 构建工具
- MySQL/StarRocks 数据库

### 构建与运行步骤

1. **配置数据库连接**
   在 `application.properties` 文件中配置数据库连接信息

2. **构建项目**
   ```bash
   mvn clean package
   ```

3. **运行应用**
   ```bash
   java -jar target/StarGuard2-1.0-SNAPSHOT.jar
   ```

4. **访问系统**
   打开浏览器，访问 `http://localhost:8080/star-guard`

## 系统特点

1. **安全性高** - 提供完善的用户认证和权限控制机制
2. **操作直观** - 友好的用户界面，简化权限管理操作
3. **功能丰富** - 支持多种权限类型和作用范围的精细化管理
4. **易于扩展** - 模块化的代码结构，便于功能扩展和维护
5. **响应式设计** - 适配不同屏幕尺寸的设备

## 使用指南

### 登录系统
1. 访问系统登录页面
2. 输入用户名和密码
3. 点击登录按钮进入主页面

### 查看用户列表
- 登录后默认显示用户列表页面
- 页面展示所有用户的基本信息，包括用户名、主机、权限数量等

### 查看用户权限详情
1. 在用户列表中，点击目标用户的"查看权限"按钮
2. 系统弹出权限详情模态框，显示用户的所有权限信息

### 授予权限
1. 点击侧边栏或标签页的"授予权限"选项
2. 填写表单信息：用户名、主机、权限类型、作用范围等
3. 点击提交按钮完成授权操作

### 撤销权限
1. 点击侧边栏或标签页的"撤销权限"选项
2. 填写表单信息：用户名、主机、要撤销的权限类型等
3. 点击提交按钮完成撤销操作

## 总结

StarGuard2 权限管理系统为数据库管理员提供了一个功能完善、操作便捷的权限管理解决方案。通过直观的用户界面和丰富的权限控制功能，帮助管理员轻松管理数据库权限，提升系统安全性和运维效率。系统采用模块化的代码结构，具有良好的可扩展性和可维护性，可根据业务需求进行功能扩展和定制开发。